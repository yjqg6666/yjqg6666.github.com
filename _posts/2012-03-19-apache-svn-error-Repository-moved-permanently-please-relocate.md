---
layout: default
title: apache+svn报错-Repository-moved-permanently-please-relocate
published: true
category: linux
tags: [apache2,svn,relocate]
---
<div id="detail" class="detail" style="line-height: 1.3;"><p>On Dec 21, 2006, at 11:14, thomas Armstrong wrote:<br><br>&gt; Using Subversion 1.4.2 (r22196) + Apache 2.0.59 on FC6, I get this<br>&gt; error<br>&gt; message when trying to checkout a project:<div>使用的是subversion&nbsp;1.4.2 (r22196) + Apache 2.0.59 on FC6, 当我检出一个工程的时候产生这个错误：<br>&gt; -------------------------------<br>&gt; []# svn --username john --password foo co http://svn.mydomain.com/<br>&gt; project2<br>&gt; svn: PROPFIND request failed on '/project2'<br>&gt; svn: PROPFIND of '/project2': 301 Moved Permanently (http://<br>&gt; svn.mydomain.com)<br>&gt; ---------------------------------</div><div>301永久移往其它地方<br>&gt;<br>&gt; If I visit http://svn.mydomain.com/project2, I get a right webpage<br>&gt; (I think):</div><div>但是我访问那个地址又可以得到正确的页面<br>&gt; --------------<br>&gt; Revision 0: /<br>&gt; Powered by Subversion version 1.4.2 (r22196).<br>&gt; --------------<br>&gt; and I'm required to type user (john) and password (foo)<br>&gt;<br>&gt; This is my 'httpd.conf'<br>&gt; ------------------------<br>&gt; &lt;VirtualHost svn.mydomain.com&gt;<br>&gt; ServerName svn.mydomain.com<br>&gt; DocumentRoot /home/svn-repos<br>&gt; &lt;Location /project2&gt;<br>&gt; DAV svn<br>&gt; SVNPath /home/svn-repos/project2/trunk<br>&gt; # our access control policy<br>&gt; AuthzSVNAccessFile /etc/svn-access-file<br>&gt; AuthType Basic<br>&gt; AuthName "Authorization Realm"<br>&gt; AuthUserFile /etc/svn-auth-file<br>&gt; Require valid-user<br>&gt; &lt;/Location&gt;<br>&gt; &lt;/VirtualHost&gt;<br>&gt; ----------<br>&gt;<br>&gt; What am I doing wrong? Thank you very much.<br><br>Do not locate your repositories under your DocumentRoot. Either put<br>your repositories somewhere other than /home/svn-repos, or set your<br>DocumentRoot to something other than /home/svn-repos.</div><div>不要将你的库放在文档根目录（DocumentRoot）下。 要么把你的库放在除／home／svn－repos外的其它地方， 或者设置文档根目录到／home／svn－repos外的其它目录<br><br>Also, why have you set SVNPath to /home/svn-repos/project2/trunk?<br>Have you really created a repository inside /home/svn-repos/project2<br>called "trunk"? That would be very unusual. The recommended layout of<br>trunk / branches / tags is designed to be created within a single<br>repository. The whole point is to be able to copy the trunk to a<br>branch or tag, and you can only copy within a repository, not between<br>repositories.</div><div>还有 为什么你要把SVNPath设置成/home/svn-repos/project2/trunk 你是不是真的在/home/svn-repos/project2目录下建了个名为‘trunk‘的库。 通常不要那样。 trunk/branches/tags是建议的布局， 是在单个库内创建的。 &nbsp;重点是我们把一个主干复制到一个分支或标签中， 你只能在一个库内复制， 而不能在库之间复制。<br><br>Also, the fact that you're showing a project2 suggests that you have<br>other projects as well. Perhaps you'd prefer the SVNParentPath<br>directive so you can add an arbitrary number of repositories without<br>having to revisit the Apache configuration?</div><div>而且， 从上面也可以看出你还有其它项目。 或许你应该趋向于使用SVNParentPath指令 你可以添加 任意多个的库 而不用再修改apache的配置</div><div><br>I'd suggest this setup:</div><div>推荐配置：<br><br>&lt;VirtualHost *:80&gt;<br>ServerName svn.mydomain.com<br>DocumentRoot /home/svn-repos/docroot<br>&lt;Location /svn&gt;<br>DAV svn<br>SVNParentPath /home/svn-repos/repositories<br># our access control policy<br>AuthzSVNAccessFile /etc/svn-access-file<br>AuthType Basic<br>AuthName "Authorization Realm"<br>AuthUserFile /etc/svn-auth-file<br>Require valid-user<br>&lt;/Location&gt;<br>&lt;/VirtualHost&gt;<br><br>Now you can create as many repositories under /home/svn-repos/<br>repositories as you like. You can access them via http://<br>svn.mydomain.com/svn/project1 and so forth. Within each repository,<br>you can use "svn mkdir" to create the directories trunk / branches /<br>tags. Your document root is in a separate place from where the<br>repositories are. 现在你可以在／home／svn－repos下创建库，想建多少就可以建多少 你可以通过 http://</div>svn.mydomain.com/svn/project1来访问project1库 同理也可以访问其它库。 在每个库下 你可以使用 svn mkdir创建主干／分去／标签 &nbsp; &nbsp;你的文档根目录不同于库所在目录。<div>You can use the docroot directory to store<br>favicon.ico, robots.txt and any other items that by convention or<br>standard must be at the root of the URL space. (If you use<br>"&lt;Location /&gt;" you lose the ability to use such files.) If you don't<br>want or need to use such files, you can just set the DocumentRoot to<br>an empty directory somewhere. (My system has /var/empty.) If you want<br>favicon.ico, robots.txt and any other items that might be in your<br>document root to be elsewhere, such as within a docroot *repository*<br>that you might set up for that purpose, you might be able to set up<br>some Alias directives mapping /favicon.ico to /svn/docroot/<br>favicon.ico and so forth.</div><div>你可以使用文档根目录来保存favicon。ico ， robots。txt 及其它根据惯例或标准必须放在URL空间根的文件。 &nbsp;如果你使用Location则失去了使用这些文件的能力。 如果你不想或者不需要使用这些文件， 你只需要设置文档根目录为某个空目录（ 我的系统有个／var／empty）如果你想要本应该放在文档根目录下的favicon.ico, robots.txt及其它文件放到其它地方 &nbsp;比如说 文档根目录下的库 你可以设置一个别名指令来映射&nbsp;</div><div>／favicon.ico到/svn/docroot/favicon.ico以此类推。<br><br><br>-- <br><br>To reply to the mailing list, please use your mailer's Reply To All<br>function<br><br><br>把我的配置的DocumentRoot和SVNParent改成不一样的就不报错了&nbsp; <br><br>&lt;VirtualHost *:80&gt;<br>&nbsp;&nbsp;&nbsp; ServerAdmin webmaster@localhost<br><br>&nbsp;&nbsp;&nbsp; ServerName svn.z.cn<br>&nbsp;&nbsp;&nbsp; DocumentRoot /var/www/<br>&nbsp;&nbsp;&nbsp; &lt;Location /&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DAV svn<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SVNParentPath /prog/svn/<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #SVNListParentPath on<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AuthType Basic<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AuthName "Subversion Repository"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AuthUserFile /etc/apache2/dav_svn.passwd<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AuthzSVNAccessFile /etc/apache2/dav_svn.authz<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Require valid-user<br>&nbsp;&nbsp;&nbsp; &lt;/Location&gt;<br>&nbsp;&nbsp;&nbsp; ErrorLog ${APACHE_LOG_DIR}/error.log<br>&nbsp;&nbsp;&nbsp; # Possible values include: debug, info, notice, warn, error, crit,<br>&nbsp;&nbsp;&nbsp; # alert, emerg.<br>&nbsp;&nbsp;&nbsp; LogLevel debug<br><br>&nbsp;&nbsp;&nbsp; CustomLog ${APACHE_LOG_DIR}/access.log combined<br>&lt;/VirtualHost&gt;<br></div></p></div>
