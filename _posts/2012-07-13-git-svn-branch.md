---
layout: default
title: git-svn添加svn分支
published: true
category: git
tags: [git,svn,git-svn,分支]
---
<div id="detail" class="detail" style="line-height: 1.3;"><p>from&nbsp;<a href="http://https://community.jboss.org/wiki/DevelopingOnMultipleSVNBranchesWithGit?_sscc=t" target="_blank">https://community.jboss.org/wiki/DevelopingOnMultipleSVNBranchesWithGit?_sscc=t</a><div><br></div><div><div class="jive-content-header clearfix"><div class="jive-content-header-details">&nbsp; Created on: Sep 28, 2010 5:25 PM by
<a href="https://community.jboss.org/people/rhauch" data-externalid="" data-username="rhauch" data-avatarid="3898" id="jive-21462911545029662820" class="jiveTT-hover-user jive-username-link" target="_blank">Randall Hauch</a>            -
Last Modified:&nbsp;
Sep 28, 2010 5:55 PM
by <a href="https://community.jboss.org/people/rhauch" data-externalid="" data-username="rhauch" data-avatarid="3898" id="jive-21462911545031549820" class="jiveTT-hover-user jive-username-link" target="_blank">Randall Hauch</a>		</div>

	</div>
	<div class="jive-content-body">


<div class="jive-rendered-content"><p>If you're using Git SVN as your 
local SVN client, you no doubt understand the benefits of having 
multiple local branches. Well, you can also use this same local Git 
repository to help you work with multiple SVN branches, too.&nbsp; This 
article shows you how to create branches in your Git repository that 
mirror the remote branches, and describes a simple workflow for applying
 changes to multiple branches.</p><p style="min-height: 8pt; height: 8pt; ">&nbsp;</p>Setup<p>Your
 local Git repository will already know about any SVN branches and tags 
that existed when you created your Git repository by cloning SVN. But it
 may not know about any more recent branches. So the first thing is to 
tell your local git repository about the new branch in SVN. For example 
purposes, we'll assume we're going to work on the '2.2.x' branch.</p><p style="min-height: 8pt; height: 8pt; ">&nbsp;</p><p>These two commands add information to your local '.git/config' file:</p><p style="min-height: 8pt; height: 8pt; ">&nbsp;</p><p style="padding-left: 30px;"><span style="font-family: 'courier new', courier;">$ <font color="#008000">git config --add svn-remote.</font></span><font color="#008000"><strong style="font-family: 'courier new', courier; ">2.2.x</strong><span style="font-family: 'courier new', courier;">.url </span><a class="jive-link-external-small" href="https://svn.jboss.org/repos/modeshape/branches/2.2.x/" target="_blank"><span style="font-family: 'courier new', courier;"><font color="#008000">https://svn.jboss.org/repos/modeshape/branches/2.2.x/</font></span></a></font></p><p style="padding-left: 30px;"><span style="font-family: 'courier new', courier;">$<font color="#008000"> git config --add svn-remote.</font></span><font color="#008000"><strong style="font-family: 'courier new', courier; ">2.2.x</strong><span style="font-family: 'courier new', courier;">.fetch :refs/remotes/</span><strong style="font-family: 'courier new', courier; ">2.2.x</strong></font></p><p style="min-height: 8pt; height: 8pt; ">&nbsp;</p><p>The bold '<strong>2.2.x</strong>'
 is the local name for the branch. Next, fetch all of the history for 
the branch (this may take a bit, though there is not a lot of commits on
 this branch):</p><p style="min-height: 8pt; height: 8pt; ">&nbsp;</p><p style="padding-left: 30px;"><span style="font-family: 'courier new', courier;">$ <font color="#008000">git svn fetch </font></span><strong style="font-family: 'courier new', courier; "><font color="#008000">2.2.x</font></strong></p><p style="min-height: 8pt; height: 8pt; ">&nbsp;</p><p>You
 need a local branch that you can work with, so create one called 
'local-2.2.x' that is tied directly to the remote '2.2.x' branch:</p><p style="min-height: 8pt; height: 8pt; ">&nbsp;</p><p style="padding-left: 30px;"><span style="font-family: 'courier new', courier;">$ <font color="#008000">git checkout -b local-2.2.x -t </font></span><strong style="font-family: 'courier new', courier; "><font color="#008000">2.2.x</font></strong></p><p style="min-height: 8pt; height: 8pt; ">&nbsp;</p><p>Check that your local git config file looks right. The relevant lines are shown below:</p><p style="min-height: 8pt; height: 8pt; ">&nbsp;</p><p style="padding-left: 30px;"><span style="font-family: 'courier new', courier;">$ more .git/config </span></p><p style="padding-left: 30px;"><span style="font-family: 'courier new', courier;">...</span></p><p style="padding-left: 30px;"><span style="font-family: 'courier new', courier;">[svn-remote "2.2.x"]</span></p><p style="padding-left: 30px;"><span style="white-space: pre; font-family: 'courier new', courier;"> </span><span style="font-family: 'courier new', courier;">url = </span><a class="jive-link-external-small" href="https://svn.jboss.org/repos/modeshape/branches/2.2.x/" target="_blank"><span style="font-family: 'courier new', courier;">https://svn.jboss.org/repos/modeshape/branches/2.2.x/</span></a></p><p style="padding-left: 30px;"><span style="white-space: pre; font-family: 'courier new', courier;"> </span><span style="font-family: 'courier new', courier;">fetch = :refs/remotes/2.2.x</span></p><p style="padding-left: 30px;"><span style="font-family: 'courier new', courier;">[branch "local-2.2.x"]</span></p><p style="padding-left: 30px;"><span style="white-space: pre; font-family: 'courier new', courier;"> </span><span style="font-family: 'courier new', courier;">remote = .</span></p><p style="padding-left: 30px;"><span style="white-space: pre; font-family: 'courier new', courier;"> </span><span style="font-family: 'courier new', courier;">merge = refs/remotes/2.2.x</span></p><p style="padding-left: 30px;"><span style="font-family: 'courier new', courier;">...</span></p><p style="min-height: 8pt; height: 8pt; ">&nbsp;</p><p>Check that the branches are defined correctly by listing <em>all</em> branches. The output should include the '2.2.x' remote branch (in red), plus the 'local-2.2.x' local branch:</p><p style="min-height: 8pt; height: 8pt; ">&nbsp;</p><p style="padding-left: 30px;"><span style="font-family: 'courier new', courier;">$ git branch -a</span></p><p style="padding-left: 30px;"><span style="font-family: 'courier new', courier;">...<br></span></p><p style="padding-left: 30px;"><span style="font-family: 'courier new', courier;">local-2.2.x</span></p><p style="padding-left: 30px;"><span style="font-family: 'courier new', courier;">...</span></p><p style="padding-left: 30px;"><span style="font-family: 'courier new', courier;">2.2.x</span></p><p style="padding-left: 30px;"><span style="font-family: 'courier new', courier;">...</span></p><p style="min-height: 8pt; height: 8pt; ">&nbsp;</p><p style="min-height: 8pt; height: 8pt; ">&nbsp;</p>Developing on the branch<p>I
 generally develop on topic branches, commit locally, merge to 'master' 
(trunk), and dcommit (push to SVN trunk).&nbsp; Here's my basic workflow:</p><p style="min-height: 8pt; height: 8pt; ">&nbsp;</p><p style="padding-left: 30px;"><span style="font-family: 'courier new', courier;">$ git checkout -b mode-903</span></p><p><span style="font-family: 'courier new', courier;"><br></span></p><p style="padding-left: 30px;"><em style="font-family: 'courier new', courier; "># ...&nbsp; lots of changes ...</em></p><p><span style="font-family: 'courier new', courier;"><br></span></p><p style="padding-left: 30px;"><span style="font-family: 'courier new', courier;">$ git commit -m "MODE-903 ..."</span></p><p style="padding-left: 30px;"><span style="font-family: 'courier new', courier;">$ git checkout master</span></p><p style="padding-left: 30px;"><span style="font-family: 'courier new', courier;">$ git svn rebase</span></p><p style="min-height: 8pt; height: 8pt; ">&nbsp;</p><p>If
 there are changes, you need to rebase first. The following command will
 check out the 'mode-903' branch and do a 'git rebase master', leaving 
you on the 'mode-903 branch'. The second command takes you back to your 
master branch:</p><p style="min-height: 8pt; height: 8pt; ">&nbsp;</p><p style="padding-left: 30px;"><span style="font-family: 'courier new', courier;">$ git rebase master mode-903<br></span></p><p style="padding-left: 30px;"><span style="font-family: 'courier new', courier;">$ git checkout master</span></p><p style="min-height: 8pt; height: 8pt; ">&nbsp;</p><p>Now,
 your 'mode-903' topic branch is updated with the latest from SVN and 
includes your (locally committed) changes, so merge those changes onto 
master and push them to SVN:</p><p style="min-height: 8pt; height: 8pt; ">&nbsp;</p><p style="padding-left: 30px;"><span style="font-family: 'courier new', courier;">$ git merge mode-903</span></p><p style="padding-left: 30px;"><span style="font-family: 'courier new', courier;">$ git svn dcommit</span></p><p style="padding-left: 30px;"><span style="font-family: 'courier new', courier;">Committing to </span><a class="jive-link-external-small" href="https://svn.jboss.org/repos/modeshape/trunk" target="_blank"><span style="font-family: 'courier new', courier;">https://svn.jboss.org/repos/modeshape/trunk</span></a><span style="font-family: 'courier new', courier;"> ...</span></p><p style="padding-left: 30px;"><span style="white-space: pre; font-family: 'courier new', courier;"> </span><span style="font-family: 'courier new', courier;">M</span><span style="white-space: pre; font-family: 'courier new', courier;"> </span><span style="font-family: 'courier new', courier;">docs/reference/src/main/docbook/en-US/content/jcr/web_access.xml</span></p><p style="padding-left: 30px;"><span style="font-family: 'courier new', courier;">Committed r2304</span></p><p style="padding-left: 30px;"><span style="white-space: pre; font-family: 'courier new', courier;"> </span><span style="font-family: 'courier new', courier;">M</span><span style="white-space: pre; font-family: 'courier new', courier;"> </span><span style="font-family: 'courier new', courier;">docs/reference/src/main/docbook/en-US/content/jcr/web_access.xml</span></p><p style="padding-left: 30px;"><span style="font-family: 'courier new', courier;">r2304 = </span><strong style="font-family: 'courier new', courier; ">f08cf3801</strong><span style="font-family: 'courier new', courier;">79691e195bf3f2dfb16aecb4f8c00ee (trunk)</span></p><p style="padding-left: 30px;"><span style="font-family: 'courier new', courier;">No changes between current HEAD and refs/remotes/trunk</span></p><p style="padding-left: 30px;"><span style="font-family: 'courier new', courier;">Resetting to the latest refs/remotes/trunk</span></p><p style="min-height: 8pt; height: 8pt; ">&nbsp;</p><p>Until
 this point, the workflow is just working on 'master' (trunk). If you 
want to take those same changes and apply them to the '2.2.x' branch in 
SVN, you need to do that next.</p><p style="min-height: 8pt; height: 8pt; ">&nbsp;</p><p>The
 workflow is easy: switch to the 'local-2.2.x' branch, get the latest 
from SVN, and apply the same changes you made on 'master' onto the 
current (e.g., '2.2.x') branch. This is called cherry-picking in Git 
terminology. This is basically a shortcut for creating a patch file for a
 commit, applying that patch file to the other branch, and staging the 
changes locally. You can do this so easily because Git allows you to 
reference a commit by its reference (e.g., "f08cf3801"), which is just 
enough of the SHA-1 of the commit that is unique.&nbsp; Here are the 
commands.</p><p style="min-height: 8pt; height: 8pt; ">&nbsp;</p><p>First, switch to the local-2.2.x branch:</p><p style="min-height: 8pt; height: 8pt; ">&nbsp;</p><p style="padding-left: 30px;"><span style="font-family: 'courier new', courier;">$ git checkout local-2.2.x</span></p><p style="padding-left: 30px;"><span style="font-family: 'courier new', courier;">Switched to branch "local-2.2.x"</span></p><p style="min-height: 8pt; height: 8pt; ">&nbsp;</p><p>Then, perform the cherry-pick.</p><p style="padding-left: 30px;"><br><span style="font-family: 'courier new', courier;">$ git cherry-pick f08cf3801 -n</span></p><p style="padding-left: 30px;"><span style="font-family: 'courier new', courier;">Finished one cherry-pick.</span></p><p style="min-height: 8pt; height: 8pt; ">&nbsp;</p><p>The
 '-n' flag tells Git that you don't want the changes automatically 
committed with the same commit message. You'd actually like to do that, 
except that Git SVN includes the SVN URL in the commit message, so a 
message for a commit against 'trunk' will be a little wrong if it's used
 as the message for a commit against another branch.&nbsp; Using the '-n' 
flag gets around that.</p><p style="min-height: 8pt; height: 8pt; ">&nbsp;</p><p>You
 now have in your staging area the changes from the referenced commit, 
and you simply need to commit them and push them to the '2.2.x' branch 
in SVN. You could retype your commit, but if you have history setup, you
 can just re-run the appropriate 'git commit ' command.</p><p style="min-height: 8pt; height: 8pt; ">&nbsp;</p><p style="padding-left: 30px;"><span style="font-family: 'courier new', courier;">$ history 30</span></p><p style="padding-left: 30px;"><span style="font-family: 'courier new', courier;"># find the command in the output; let's say it's command 1234</span></p><p style="padding-left: 30px;"><span style="font-family: 'courier new', courier;">$ !1234</span></p><p style="min-height: 8pt; height: 8pt; ">&nbsp;</p><p>Or you can just type out the commit again:</p><p style="min-height: 8pt; height: 8pt; ">&nbsp;</p><p style="padding-left: 30px;"><span style="font-family: 'courier new', courier;">$&nbsp; git commit -m "MODE-903 ..."</span></p><p style="min-height: 8pt; height: 8pt; ">&nbsp;</p><p>Now that you've committed locally, you can push the commit to SVN by doing a normal 'dcommit'.</p><p style="min-height: 8pt; height: 8pt; ">&nbsp;</p><p style="padding-left: 30px;"><span style="font-family: 'courier new', courier;">$ git svn dcommit</span></p><p style="min-height: 8pt; height: 8pt; ">&nbsp;</p>Applying multiple commits to a branch<p>Sometimes,
 you might create multiple commits on your topic branch, merge those 
onto 'master', and push them to SVN's trunk. Cherry-picking these onto 
your local '2.2.x' branch is easy: just use a cherry-pick and local 
commit command for each of the commits you want to cherry pick. Then, 
you have multiple local commits on the '2.2.x' branch, and a single 
'dcommit' will push them all into SVN.</p></div></div></div></p></div>
